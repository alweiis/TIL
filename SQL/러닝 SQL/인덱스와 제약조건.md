# 인덱스와 제약조건

### 인덱스

- 인덱스는 간단히 말하자면 자료 내에서 `특정 항목을 찾기 위한 메커니즘`이다.
- 사람이 인덱스를 사용해서 책에서 단어를 찾는 것과 같은 방식으로 데이터베이스 서버는 인덱스를 사용해서 테이블에서 행을 찾는다.
- 인덱스는 일반적인 데이터 테이블과 달리 특정 순서로 `유지되는` 특수 테이블이다.
- 인덱스의 역할은 테이블의 모든 행을 확인할 `필요 없이` 테이블의 행과 열의 서브셋을 쉽게 검색하는 것이다.

#### 인덱스 생성

- MySQL 데이터베이스에서 인덱스를 추가하는 방법은 다음과 같다.

  ```mysql
  mysql> ALTER TABLE customer
      -> ADD INDEX idx_email (email);
  ```

- 고유 인덱스

  - 일반 인덱스의 모든 이점을 제공함과 동시에 인덱스 열에 중복값을 허용하지 않는다.

    ```mysql
    mysql> ALTER TABLE customer
        -> ADD UNIQUE INDEX idx_email (email);
    ```

- 다중 열 인덱스

  - 단일 열 인덱스와 더불어 다중 열을 사용해서 인덱스를 만들 수도 있다.

  - 예를 들어 `이름과 성`으로 고객을 검색할 경우 다음과 같이 `두 열`을 함께 사용해서 인덱스를 만들 수 있다.

    ```mysql
    mysql> ALTER TABLE customer
        -> ADD INDEX idx_full_name (last_name, first_name);
    ```

  - 이 인덱스는 성과 이름 또는 성만 검색하는 쿼리에는 유용하지만, 이름만 검색하는 쿼리에는 유용하지 않다.

  - 왜냐하면 상대방의 전화번호를 찾는 방법을 떠올려보면 상대방의 이름과 성을 알면 전화번호부는 성과 이름으로 구성되므로
    전화번호부를 사용해서 신속하게 번호를 찾을 수 있다.

  - 하지만 단지 이름만 안다면 전화번호부의 모든 항목을 스캔해서 정의한 이름을 가진 모든 항목을 찾아야 한다.

  - 따라서 다중 열 인덱스를 생성할 때는 인덱스를 최대한 유용하게 만들기 위해 먼저 정의할 열과 두 번째로 정의할 열을 신중하게 고려해야 한다,

#### 인덱스 유형

- B-트리 인덱스
  - MySQL, Oracle 데이터베이스, SQL Server는 모두 기본값(default)로 B-트리 인덱스를 사용한다.
  - B-트리 인덱스는 `잎 노드(leaf node)`와 하나 이상의 `가지 노드(branch node)`레벨이 있는 트리로 구성된다.
  - 가지 노드는 트리 탐색에 사용되는 반면 잎 노드는 실제 값과 위치 정보를 가진다.

![image-20220403161024466](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20220403161024466.png)

<center>(이미지 출처 : 러닝 SQL)</center>

- 위의 이미지는 고객 정보를 담고 있는 테이블의 성(last_name) 칼럼을 간략히 도식화 한 것이고, 이 테이블에서 성이 G로 시작하는 모든 고객을 검색하는 쿼리를 실행한다면, 서버는 최상위 가지 노드(root node)를 살펴보고 A부터 M까지로 시작하는 성을 처리하는 가지 노드의 링크를 따라간다.
- 다음으로 이 가지 노드는 차례로 G에서 I까지로 시작하는 성을 포함하는 잎 노드로 간다.
- 그런 다음 서버는 G로 시작하지 않는 값을 만날 때까지 잎 노드의 값을 읽는다.

#### 인덱스의 단점

- 인덱스의 장점에도 불구하고 많은 인덱스가 반드시 좋은 것은 아니다.
- 모든 인덱스는 결국 (특수한 유형의) 테이블 이기 때문이다.
- 따라서 행의 추가, 삭제, 수정마다 데이터베이스 서버는 해당 테이블의 모든 인덱스를 수정해야 한다.
- 따라서 인덱스가 많을수록 서버가 모든 스키마를 최신 상태로 유지하기 위해 더 많은 작업을 수행해야 하므로 속도가 느려진다.

<br>

### 제약조건

- 제약은 단순히 테이블의 하나 이상의 열에 적용되는 제한사항으로 다음과 같은 유형의 제약조건이 있다.
  - 기본키 제약조건
    - 테이블 내에서 고유성을 보장하는 열을 식별한다.
  - 외래키 제약조건
    - 다른 테이블의 기본 키 열에 있는 값만 포함하도록 하나 이상의 열을 제한한다.
  - 고유 제약조건
    - 테이블 내에서 고유한 값을 포함하도록 하나 이상의 열을 제한한다.
  - 체크 제약조건
    - 열에 허용되는 값을 제한한다.